<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Stack+Sans+Notch:wght@200..700&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
        integrity="sha512-vKMx8UnXk60zUwyUnUPM3HbQo8QfmNx7+ltw8Pm5zLusl1XIfwcxo8DbWCqMGKaWeNxWA8yrx5v3SaVpMvR3CA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <div class="main-container">
        <div class="row">
            <div class="col-lg-2">
                <div class="row sidebar">
                    <div class="col-lg-12 text-center">
                        <a style="text-decoration: none;" href="../index.html">
                            <h2 class="logo">FileShare</h2>
                        </a>
                    </div>
                    <div class="divider"></div>
                    <div class="col-lg-12 menu">
                        <div class="col-lg-12">
                            <a class="row menu-link" onclick="showMenu(1)"
                                style="box-shadow:2px 2px grey;border-radius:10px ;background-color:#e7f3ff;padding-left: 5%; width: 100%;">
                                <div class="col-lg-9"><span><i class="fa-solid fa-plus"></i></span> <span
                                        style="padding-left: 5%;">NEW</span></div>
                                <div id="menu-link-1" data-status="0" class="col-lg-2"><i class="fa-solid fa-angles-right"></i> </div>
                            </a>

                        </div>
                        <div id="menu-content-1" style="display: none;" class="col-lg-10 menu-content">
                            <a class="menu-item col-lg-12"
                                onclick="window.location.href='../file/upload.html?id='+new URLSearchParams(window.location.search).get('id')">
                                <span><i class="fa-solid fa-minus "></i> <span style="padding-left: 5%;">Up Load File</span>
                            </a>
                        </div>
                        <div class="col-lg-12 menu">
                        <div class="col-lg-12">
                          <a class="row menu-link" href="../folder/convert.html"
                            style="box-shadow:2px 2px grey;border-radius:10px ;background-color:#e7f3ff;padding-left: 5%; width: 100%;">
                            <div class="col-lg-9"><span><i class="fa-solid fa-file-export"></i></span> <span
                                style="padding-left: 5%;">Convert Files</span></div>
                          </a>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-12 menu">
                        <div class="col-lg-12">
                            <a class="row menu-link" onclick="showMenu(6)">
                                <div class="col-lg-9"><span><i class="fa-solid fa-house-laptop"></i></span> <span
                                        style="padding-left: 5%;">Home</span></div>
                                <div id="menu-link-6" data-status="0" class="col-lg-2"><i class="fa-solid fa-angles-right"></i> </div>
                            </a>

                        </div>
                        <div id="menu-content-6" style="display: none;" class="col-lg-10 menu-content" >
                            <a class="menu-item col-lg-12" href="../index.html">
                                <span><i class="fa-solid fa-minus"></i> <span style="padding-left: 5%;">Dashboard</span>
                            </a>
                        </div>
                    </div>

                    <div class="col-lg-12 menu">
                        <div class="col-lg-12">
                            <a class="row menu-link" onclick="showMenu(2)">
                                <div class="col-lg-9"><span><i class="fa-solid fa-house-laptop"></i></span> <span
                                        style="padding-left: 5%;">Folder</span></div>
                                <div id="menu-link-2" data-status="0" class="col-lg-2"><i class="fa-solid fa-angles-right"></i> </div>
                            </a>

                        </div>
                        <div id="menu-content-2" style="display: none;" class="col-lg-10 menu-content">
                            <div class="row col-lg-12">
                                <a href="../folder/create.html" class="menu-item col-lg-12">
                                    <span><i class="fa-solid fa-minus"></i> <span style="padding-left: 5%;">Add New Folder</span>
                                </a>
                                <a href="../folder/all.html" class="menu-item col-lg-12">
                                    <span><i class="fa-solid fa-minus"></i> <span style="padding-left: 5%;">List All</span>
                                </a>
                                <a href="../folder/shareWithMe.html" class="menu-item col-lg-12">
                                    <span><i class="fa-solid fa-minus"></i> <span style="padding-left: 5%;">Share With Me</span>
                                </a>
                                <div class="menu-item col-lg-12">
                                    <label>
                                        <select id="folderDropdown" class="form-select form-select-sm"
                                            onchange="navigateToFolder(this.value)">
                                            <option value="">Loading Folder...</option>
                                        </select>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12 menu">
                        <div class="col-lg-12">
                            <a class="row menu-link" onclick="showMenu(3)">
                                <div class="col-lg-9"><span><i class="fa-solid fa-folder-open"></i></span> <span
                                        style="padding-left: 5%;">My Folders</span></div>
                                <div id="menu-link-3" data-status="0" class="col-lg-2"><i class="fa-solid fa-angles-right"></i> </div>
                            </a>

                        </div>
                        <div id="menu-content-3" style="display: none;" class="col-lg-10 menu-content">


                            <div id="folderDropdownList" class="col-lg-12">
                                <div class="text-center" style="padding: 10px; font-size: 12px; color: #999;">
                                    <i class="fa-solid fa-spinner fa-spin"></i> Loading...
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12 menu">
                        <div class="col-lg-12">
                            <a class="row menu-link" onclick="showMenu(4)">
                                <div class="col-lg-9"><span><i class="fa-solid fa-folder-open"></i></span> <span
                                        style="padding-left: 5%;">Share With Me</span></div>
                                <div id="menu-link-4" data-status="0" class="col-lg-2"><i class="fa-solid fa-angles-right"></i> </div>
                            </a>

                        </div>
                        <div id="menu-content-4" style="display: none;" class="col-lg-10 menu-content">


                            <div id="sharedFolderDropdownList" class="col-lg-12">
                                <div class="text-center" style="padding: 10px; font-size: 12px; color: #999;">
                                    <i class="fa-solid fa-spinner fa-spin"></i> Loading...
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12 menu">
                        <div class="col-lg-12">
                            <a class="row menu-link" onclick="showMenu(5)">
                                <div class="col-lg-9"><span><i class="fa-solid fa-trash"></i></span> <span
                                        style="padding-left: 5%;">Trash Bin</span></div>
                                <div id="menu-link-5" data-status="0" class="col-lg-2"><i class="fa-solid fa-angles-right"></i> </div>
                            </a>

                        </div>
                        <div id="menu-content-5" style="display: none;" class="col-lg-10 menu-content">
                            <div class="row col-lg-12">
                                <a href="../folder/trash.html" class="menu-item col-lg-12">
                                    <span><i class="fa-solid fa-trash-can"></i> <span style="padding-left: 5%;">View Trash</span>
                                </a>
                            </div>
                        </div>
                    </div>



                </div>
            </div>
            <div class="col-lg-10 main" style="
            margin-left: 0px;
            margin-right: 0px;
            padding-left: 0px;
            padding-right: 0px;
          ">
                <div class="main-navbar col-lg-12">
                    <div class="row align-items-center" style="width: 100%;">
                        <div class="col-lg-6">
                            <div class="row align-items-center">
                                <div class="col-lg-1"><i style="font-size: 20px;" class="fa-solid fa-bars"></i></div>
                                <div class="col-lg-7">
                                    <div class="input-group">
                                        <span class="input-group-text" id="basic-addon1"
                                            style="background-color:white;"><i
                                                class="fa-solid fa-magnifying-glass"></i></span>
                                        <input type="text" class="form-control" placeholder="Search" aria-label="Search"
                                            aria-describedby="basic-addon1">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="d-flex justify-content-end align-items-center" style="padding-right: 20px;">
                                <div class="dropdown">
                                    <button class="btn btn-light dropdown-toggle" type="button" id="userMenuDropdown"
                                        data-bs-toggle="dropdown" aria-expanded="false"
                                        style="border-radius: 50px; padding: 8px 20px; border: 1px solid #ddd;">
                                        <i class="fa-solid fa-user-circle"
                                            style="font-size: 20px; margin-right: 8px; color: #0d6efd;"></i>
                                        <span id="username-display" style="font-weight: 500;">User</span>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end shadow"
                                        aria-labelledby="userMenuDropdown" style="min-width: 200px;">
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="changePassword(); return false;">
                                                <i class="fa-solid fa-key" style="margin-right: 8px;"></i> Change
                                                Password
                                            </a>
                                        </li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>
                                        <li>
                                            <a class="dropdown-item text-danger" href="#"
                                                onclick="logout(); return false;">
                                                <i class="fa-solid fa-right-from-bracket"
                                                    style="margin-right: 8px;"></i> Logout
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row main-container"
                    style="padding:20px;border-radius:20px ;width: 98%;min-height: 600px;background-color: white;margin-top:100px;margin-left: 10px;margin-right: 10px;margin-bottom: 20px;">
                    <div class="col-lg-12 row">
                        <h2 id="folder-title" class="card-title text-center">Folder </h2>

                    </div>
                    <div class="col-lg-12 row">
                        <div class="col-lg-6 offset-lg-3">
                            <form id="upload-form">
                                <div class="col-lg-12">
                                    <div class="mb-3">
                                        <label for="folderSelect" class="form-label">Select Folder</label>
                                        <select class="form-select" id="folderSelect" required>
                                            <option value="">Loading folders...</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="file" class="form-label">Select File</label>
                                        <input class="form-control" type="file" id="file" required />
                                    </div>

                                    <div id="filePreview" class="mb-3" style="display: none">
                                        <div class="alert alert-info">
                                            <strong>Selected File:</strong> <span id="fileName"></span><br />
                                            <strong>Size:</strong> <span id="fileSize"></span>
                                        </div>
                                    </div>

                                    <div id="uploadProgress" class="mb-3" style="display: none">
                                        <div class="progress">
                                            <div id="progressBar"
                                                class="progress-bar progress-bar-striped progress-bar-animated"
                                                role="progressbar" style="width: 0%"></div>
                                        </div>
                                        <p class="text-center mt-2" id="progressText">Uploading...</p>
                                    </div>

                                    <button class="btn btn-primary col-lg-12" type="button" id="uploadBtn"
                                        onclick="Upload()">
                                        <i class="fa-solid fa-upload"></i> Upload File
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>


            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"
        integrity="sha512-+k1pnlgt4F1H8L7t3z95o3/KO+o78INEcXTbnoJQ/F2VqDVhWoaiVml/OEHv9HsVgxUaVW+IbiZPUJQfF/YxZw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"
        integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/js/all.min.js"
        integrity="sha512-6BTOlkauINO65nLhXhthZMtepgJSghyimIalb+crKRPhvhmsCdnIuGcVbR5/aQY2A+260iC1OPy1oCdB6pSSwQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        function showMenu(id) {
            let dropdown = document.getElementById("menu-link-" + id);
            let status = dropdown.dataset.status;
            if (status == 0) {
                document.getElementById("menu-link-" + id).innerHTML = '<i  class="fa-solid fa-angles-down"></i>';
                document.getElementById("menu-link-" + id).dataset.status = 1
                document.getElementById("menu-content-" + id).style.display = "flex";

            }
            else {
                document.getElementById("menu-link-" + id).innerHTML = '<i  class="fa-solid fa-angles-right"></i>'
                document.getElementById("menu-link-" + id).dataset.status = 0
                document.getElementById("menu-content-" + id).style.display = "none";
            }
        }

        window.onload = async function () {
            const token = localStorage.getItem("token");
            if (!token) {
                window.location.href = "../login.html";
                return;
            }

            let checkedToken = await checkToken(token);
            if (!checkedToken) {
                window.location.href = "../login.html";
                return;
            }

            // Load folders into dropdown and sidebar
            await loadFolders();
            await loadFoldersToDropdown();
            await loadShareFoldersToDropdown();
        };

        // Show file preview when file is selected
        document.getElementById("file").addEventListener("change", function (e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById("fileName").textContent = file.name;
                document.getElementById("fileSize").textContent = formatFileSize(file.size);
                document.getElementById("filePreview").style.display = "block";
            } else {
                document.getElementById("filePreview").style.display = "none";
            }
        });

        function formatFileSize(bytes) {
            if (bytes === 0) return "0 Bytes";
            const k = 1024;
            const sizes = ["Bytes", "KB", "MB", "GB"];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + " " + sizes[i];
        }

        async function loadFolders() {
            try {
                const token = localStorage.getItem("token");
                const url = "http://localhost:5025/api/Folder";

                const response = await fetch(url, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: "Bearer " + token,
                    },
                });

                const folderSelect = document.getElementById("folderSelect");

                if (response.ok) {
                    const folders = await response.json();
                    folderSelect.innerHTML = '<option value="">-- Select a folder --</option>';

                    if (Array.isArray(folders) && folders.length > 0) {
                        folders.forEach(folder => {
                            const option = document.createElement("option");
                            option.value = folder.id;
                            option.textContent = folder.name || "Unnamed Folder";
                            folderSelect.appendChild(option);
                        });

                        // Check if folder ID is in URL and pre-select it
                        const urlParams = new URLSearchParams(window.location.search);
                        const folderId = urlParams.get("id");
                        if (folderId) {
                            folderSelect.value = folderId;
                        }
                    } else {
                        folderSelect.innerHTML = '<option value="">No folders available</option>';
                        toastr.warning("You don't have any folders. Please create a folder first.");
                    }
                } else {
                    folderSelect.innerHTML = '<option value="">Error loading folders</option>';
                    toastr.error("Failed to load folders");
                }
            } catch (error) {
                console.error("Error loading folders:", error);
                toastr.error("Network error while loading folders");
            }
        }

        async function loadFoldersToDropdown() {
            try {
                const token = localStorage.getItem("token");
                const dropdownList = document.getElementById("folderDropdownList");

                if (!dropdownList) return;

                const response = await fetch("http://localhost:5025/api/Folder", {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: "Bearer " + token,
                    }
                });

                if (response.ok) {
                    const folders = await response.json();

                    dropdownList.innerHTML = "";

                    if (folders && folders.length > 0) {
                        const urlParams = new URLSearchParams(window.location.search);
                        const currentFolderId = urlParams.get('id');

                        folders.forEach(folder => {
                            const isActive = currentFolderId === folder.id;
                            const folderItem = document.createElement("a");
                            folderItem.href = `allFleInFolder.html?id=${folder.id}`;
                            folderItem.className = "menu-item";
                            folderItem.style.cssText = isActive
                                ? "display: block; width: 100%; background-color: #e7f3ff; border-left: 3px solid #0d6efd; padding: 8px 10px 8px 10%; text-decoration: none; color: inherit;"
                                : "display: block; width: 100%; padding: 8px 10px 8px 10%; text-decoration: none; color: inherit;";

                            folderItem.innerHTML = `
                <i class="fa-solid fa-folder" style="color: ${isActive ? '#0d6efd' : '#666'}; font-size: 12px;"></i> 
                <span style="padding-left: 8px; font-size: 13px;">${folder.name || 'Unnamed Folder'}</span>
              `;

                            dropdownList.appendChild(folderItem);
                        });
                    } else {
                        dropdownList.innerHTML = `
              <div class="text-center" style="padding: 10px; font-size: 12px; color: #999;">
                <i class="fa-solid fa-folder-open"></i> No folders yet
              </div>
            `;
                    }
                } else {
                    dropdownList.innerHTML = `
            <div class="text-center" style="padding: 10px; font-size: 12px; color: #dc3545;">
              <i class="fa-solid fa-exclamation-triangle"></i> Failed to load
            </div>
          `;
                    console.error("Failed to load folders:", response.status);
                }
            } catch (error) {
                console.error("Error loading folders to dropdown:", error);
                const dropdownList = document.getElementById("folderDropdownList");
                if (dropdownList) {
                    dropdownList.innerHTML = `
            <div class="text-center" style="padding: 10px; font-size: 12px; color: #dc3545;">
              <i class="fa-solid fa-exclamation-triangle"></i> Error loading
            </div>
          `;
                }
            }
        }
        async function loadShareFoldersToDropdown() {
            try {
                const token = localStorage.getItem("token");
                const dropdownList = document.getElementById("sharedFolderDropdownList");
                if (!dropdownList) return;

                const response = await fetch("http://localhost:5025/api/Folder/GetFolderByPermission", {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: "Bearer " + token,
                    }
                });

                if (response.ok) {
                    const folders = await response.json();

                    dropdownList.innerHTML = "";

                    if (folders && folders.length > 0) {
                        const urlParams = new URLSearchParams(window.location.search);
                        const currentFolderId = urlParams.get('id');

                        folders.forEach(folder => {
                            const isActive = currentFolderId === folder.id;
                            const folderItem = document.createElement("a");
                            folderItem.href = `allFleInFolder.html?id=${folder.id}`;
                            folderItem.className = "menu-item";
                            folderItem.style.cssText = isActive
                                ? "display: block; width: 100%; background-color: #e7f3ff; border-left: 3px solid #0d6efd; padding: 8px 10px 8px 10%; text-decoration: none; color: inherit;"
                                : "display: block; width: 100%; padding: 8px 10px 8px 10%; text-decoration: none; color: inherit;";

                            folderItem.innerHTML = `
                <i class="fa-solid fa-folder" style="color: ${isActive ? '#0d6efd' : '#666'}; font-size: 12px;"></i> 
                <span style="padding-left: 8px; font-size: 13px;">${folder.name || 'Unnamed Folder'}</span>
              `;

                            dropdownList.appendChild(folderItem);
                        });
                    } else {
                        dropdownList.innerHTML = `
              <div class="text-center" style="padding: 10px; font-size: 12px; color: #999;">
                <i class="fa-solid fa-folder-open"></i> No shared folders yet
              </div>
            `;
                    }
                } else {
                    dropdownList.innerHTML = `
            <div class="text-center" style="padding: 10px; font-size: 12px; color: #dc3545;">
              <i class="fa-solid fa-exclamation-triangle"></i> Failed to load
            </div>
          `;
                    console.error("Failed to load shared folders:", response.status);
                }
            } catch (error) {
                console.error("Error loading shared folders to dropdown:", error);
                const dropdownList = document.getElementById("sharedFolderDropdownList");
                if (dropdownList) {
                    dropdownList.innerHTML = `
            <div class="text-center" style="padding: 10px; font-size: 12px; color: #dc3545;">
              <i class="fa-solid fa-exclamation-triangle"></i> Error loading
            </div>
          `;
                }
            }
        }

        async function Upload() {
            try {
                const token = localStorage.getItem("token");
                if (!token) {
                    toastr.error("You must be logged in");
                    window.location.href = "../login.html";
                    return;
                }

                const folderId = document.getElementById("folderSelect").value;
                const file = document.getElementById("file").files[0];

                if (!folderId) {
                    toastr.error("Please select a folder");
                    return;
                }

                if (!file) {
                    toastr.error("Please select a file");
                    return;
                }

                // Show progress bar
                document.getElementById("uploadProgress").style.display = "block";
                document.getElementById("progressBar").style.width = "30%";
                document.getElementById("uploadBtn").disabled = true;

                // Create FormData
                const formData = new FormData();
                formData.append("File", file);
                formData.append("FolderId", folderId);
                

                const url = "http://localhost:5025/api/File";
                const response = await fetch(url, {
                    method: "POST",
                    headers: {
                       
                        Authorization: "Bearer " + token
                    },
                    body: formData,

                });

                document.getElementById("progressBar").style.width = "100%";

                if (response.ok) {
                    toastr.success("File uploaded successfully!");
                    document.getElementById("progressText").textContent = "Upload complete!";

                    // Reset form after 1.5 seconds
                    setTimeout(() => {
                        document.getElementById("upload-form").reset();
                        document.getElementById("filePreview").style.display = "none";
                        document.getElementById("uploadProgress").style.display = "none";
                        document.getElementById("uploadBtn").disabled = false;
                        document.getElementById("progressBar").style.width = "0%";
                    }, 1500);
                } else {
                    const errorText = await response.text();
                    toastr.error("Upload failed: " + errorText);
                    document.getElementById("uploadProgress").style.display = "none";
                    document.getElementById("uploadBtn").disabled = false;
                }
            } catch (error) {
                console.error("Error uploading file:", error);
                toastr.error("Network error. Please try again.");
                document.getElementById("uploadProgress").style.display = "none";
                document.getElementById("uploadBtn").disabled = false;
            }
        }



        async function checkToken(token) {
            let url = "http://localhost:5025/api/Account/CheckToken";
            const response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: "Bearer " + token,
                },
                body: null,
            });
            if (response.ok) {
                return true;
            } else {
                return false;
            }
        }

        async function logout() {
            if (!confirm("Are you sure you want to logout?")) {
                return;
            }

            try {
                const token = localStorage.getItem("token");
                if (!token) {
                    toastr.warning("No active session found");
                    window.location.href = "../login.html";
                    return;
                }

                const response = await fetch("http://localhost:5025/api/Account/Logout", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: "Bearer " + token,
                    }
                });

                if (response.ok) {
                    localStorage.removeItem("token");
                    toastr.success("Logged out successfully!");
                    setTimeout(() => {
                        window.location.href = "../login.html";
                    }, 1000);
                } else if (response.status === 401) {
                    localStorage.removeItem("token");
                    toastr.warning("Session expired. Redirecting to login...");
                    setTimeout(() => {
                        window.location.href = "../login.html";
                    }, 1000);
                } else {
                    const errorText = await response.text();
                    toastr.error(errorText || "Logout failed. Please try again.");
                }
            } catch (error) {
                console.error("Error during logout:", error);
                localStorage.removeItem("token");
                toastr.warning("Network error. Logged out locally.");
                setTimeout(() => {
                    window.location.href = "../login.html";
                }, 1500);
            }
        }

        function changePassword() {
            toastr.info("Change password feature - Coming soon!");
        }
    </script>
</body>

</html>